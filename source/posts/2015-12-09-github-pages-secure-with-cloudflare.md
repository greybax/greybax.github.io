# HTTPS для Github Pages через CloudFare (Free)

_December 9, 2015_

#https, #cloudfare

Наверно многие хотят видеть у своего сайта зеленый значок защищенного соединения (https).
К сожалению, существет ряд причин по которым это бывает сделать довольно не просто. Например, GitHub Pages до сих 
пор не поддерживают HTTPS для кастомных доменов 
([Add HTTPS support to Github Pages](https://github.com/isaacs/github/issues/156) - это неофициальный багтрекинг Github Pages).

Есть 2 возможности обойти это ограничение:
* использовать собственный сервер для хостинга вашего сайта. Способ настройки https в данном случае хорошо описан 
[Hosting GitHub Pages with HTTPS](https://outcoldman.com/en/archive/2015/08/30/hosting-github-pages-with-https/)
* использовать сервисы (например CloudFare).

О втором варианте я и хочу рассказать в этой заметке.

Подразумевается, что вы знакомы с Githab Pages и знаете как хостить там свой сайт.

В качестве бонуса, сайт будет загружаться быстрее (Cloudflare кэширует ваш сайт и поддерживает новые протоколы 
SPDY и IPv6).

С другой стороны, данное решение имеет некоторые ограничения и не подходит для ряда случаев:

* Если вы используете свой собственный домен, то соединение между серверами Cloudflare и Github вовсе 
не обеспечивает безопаность данных. Это соединение, как правило, надежнее по сравнению с WiFi в кафе, но оно
не защищено от современных  атак. Это ограничение, связано с тем, что Github не поддерживает безопасные соединения для 
пользовательских доменов.

* Старые браузеры не поддерживают защищенные соединения. Если это критично для вас вы можете использовать платный план.
Единственный способ для Cloudflare поддерживать старые браузеры - предоставление выделенного IP-адреса для вашего 
сайта, которые они не могут обеспечить всем бесплатно.

## Установка

1. Создаем аккаунт на [Cloudflare](https://www.cloudflare.com/)
2. Проходим по шагам настройки Cloudflare для вашего домена
3. Деелегируем DNS nameservers на Cloudflare. 
После чего вы сможете управлять настройками DNS для вашего домаента. Для Github Pages вам нужно иметь корневую 
CNAME запись, которая ссылается на домен вида ```<your_github_alias>.github.io```. 
4. Включаем SSL опцией **Flexible SSL** в настройках. Если вы не используете кастомный домен, то для большей 
защищенности можно выбрать опцию **Full(Strcit)**. Ждем в течение 24 часов, пока применятся изменения в DNS и 
Cloudflare сгенерирует SSL сертификат для вашего домена.
5. После выполнения этих шагов ваш домен будет доступен через Cloudflare как по защищенному так и по незащищенному
соединению.
6. Настраиваем редирект на  ```https```:

    6.1 из Cloudflare консоли переходим в **Page Rules**
    6.2 добавляем URL pattern ```http://yourwebsite/*```
    6.3 выбираем **Always use HTTPS**
    6.4 Нажимаем **Add Rule**

7. Наслаждаемся результатом и идем пить кофе.

P.S. В связи с тем, что Cloudflare кеширует изменения на вашем сайте, они отображаются сразу.
Тем ни менее, вы всегда можете перейти в консоль Cloudflare и перевести домен в режиме разработчика 
(который временно отключить кэширование).
    